<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>js::api()</title>
<link href="style.css" rel="stylesheet">
<script src="script.js"></script>
</head>

<body>

<article>
<header>
<h1>js::api()</h1>
<nav><a href="./"><img src="back.svg" width="24" height="24" title="ホームに戻る"></a></nav>
</header>
<div id="contents">

<p>JavaScriptに適したAPIを提供する。<br>
JavaScriptからPHPのメソッドを実行する感覚のAPIです</p>

<table class="function">
<tr><th>引数</th><th>説明</th></tr>
<tr class="require"><td>1</td><td>
オブジェクト<br>
このオブジェクトのメソッドがAPIとして提供されます
</td></tr>
<tr class="option"><td>2</td><td>
JSONの設定があれば連想配列で<br>
<a href="response-json.html">response::json</a>の第二引数と同じ内容
</td></tr>
<tr class="return"><td>戻</td><td>
なし
</td></tr>
</table>

<h3>PHP側</h3>

<p>事前準備としてAPIとして提供するクラスを作成します。このメソッドがAPIとなります。</p>
<code class="php" data-title="PHP側"><!--
class exapmle{
    function plus($a, $b){
        return $a + $b;
    }
}

js::api(new exapmle);
--></code>
<p class="info-red">PHP側の引数は外部からの入力となるため、セキュリティには注意を払う必要があります</p>

<p class="info-blue">プライベートメソッドとマジックメソッドはAPIから実行できません</p>
<h3>JavaScript側</h3>

<p>事前準備として <a href="api.js">api.js</a> モジュールが必要です。<br>
またモジュールファイル内で、js::api()を実行できるURLを設定しておきます。</p>

<p>JavaScript側ではPHPのメソッドを実行するだけです。戻り値は常に<var>Promise</var>です</p>
<code class="js" data-title="JavaScript側"><!--
import example from './api.js';

example.plus(1, 2)
.then(result => console.log(result)); // 3
--></code>

<p class="info-yellow">api.js は IE に対応していません</p>


<h3>ファイル送信</h3>
<p>JavaScriptのFile/Blobオブジェクトに対応しているので、ファイルはそのまま送信できます</p>
<code class="html" data-title="ファイル送信例"><!--
<input id="userfile" type="file">

<script type="module">
import api from './api.js';

userfile.onchange = function(){
    const file = this.files[0];  // Fileオブジェクト
    api.upload(file.name, file); // 受信するPHP側でもファイルはそのまま保存できます
};
</script>
--></code>

</div>
</article>

</body>
</html>