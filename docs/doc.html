<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>docクラス</title>
<link href="style.css" rel="stylesheet">
<script src="script.js"></script>
</head>

<body>

<article>
<header>
<h1>docクラス</h1>
<nav><a href="./"><img src="back.svg" width="24" height="24" title="ホームに戻る"></a></nav>
</header>

<div id="contents">

<p>PHPのDOMを使いやすくするクラス。HTMLの出力用に</p>

<h2>new</h2>
<p>docオブジェクトを作成する</p>
<table class="function">
<tr><th>引数</th><th>説明</th></tr>
<tr class="option"><td>1</td><td>
HTML文字列<br>
省略時は内蔵テンプレートが使用されます。下記サンプルと同じHTMLです
</td></tr>
<tr class="return"><td>戻</td><td>
docオブジェクト
</td></tr>
</table>

<code class="php"><!--
$doc = new doc('<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title></title></head><body></body></html>');
--></code>

<ul>
<li>HTMLは、全体を1つのタグで囲っておく必要があります</li>
<li>ベースとなるHTMLには<var>&lt;!DOCTYPE&gt;</var>を忘れずに記述してください</li>
</ul>

<h2>HTMLの出力</h2>

<p>docオブジェクトは<var>print</var>するだけでHTMLを表示できます。<br>
このオブジェクトは、文字列として評価されると自動的に文字列に変換されます。</p>

<code class="php" data-title="HTMLの出力"><!--
$doc = new doc();
print $doc; //HTMLが表示される

$str = "$doc"; //文字列としてコピーされる
--></code>


<h2>要素の選択</h2>

<h3>ID名から選択</h3>

<p>docオブジェクトでは、ID名から要素を選択するのが基本となります。<var>$doc-&gt;ID名</var><br>

<b>操作したいタグには、あらかじめID属性を付けておくのがポイントです。</b></p>

<code class="php" data-title="idで選択"><!--
$doc = new doc('<div id="example"><div>');
$doc->exapmle->textContent = '本文';
--></code>


<p>ID名に「ハイフン」を含む場合は「アンダーバー」に置き換えてもアクセスできます</p>

<code class="php" data-title="ハイフンを含むid"><!--
$doc = new doc('<div id="ex-ample"><div>'); //id名にハイフンを含む
$div = $doc->ex_apmle; //ハイフンをアンダーバーに置き換え
--></code>


<h3>セレクタで選択</h3>
<p>docオブジェクトでは簡易的なセレクタが利用できます。</p>

<table>
<tr><th>セレクタ一覧</th></tr>
<tr><td>.クラス名</td></tr>
<tr><td>[属性名]</td></tr>
<tr><td>[属性名="属性値"]</td></tr>
<tr><td>タグ名</td></tr>
<tr><td>*</td></tr>
</table>


<p>セレクタを利用するには<var>$doc('セレクタ')</var>とします。jQuery風。<br>
戻り値はいずれも配列風オブジェクトです。<var>foreach</var>で回すか、<var>[n]</var>で各要素にアクセスできます。</p>

<code class="php" data-title="セレクタで選択"><!--
// dummyクラスを持つ要素を全削除
foreach($doc('.dummy') as $el) {
    $el->parentNode->removeChild($el);
}

//metaタグが選択されるであろう
$meta_description = $doc('[name="description"]')[0]; 
--></code>
<p>※複数のセレクタを組み合わせることはできません。</p>

<h3>特別な選択</h3>

<p><var>&lt;html&gt;</var><var>&lt;head&gt;</var><var>&lt;body&gt;</var><var>&lt;title&gt;</var>の4つのタグは、特別に<var>$doc-&gt;タグ名</var>でアクセスできます</p>

<code class="php" data-title="特別な選択"><!--
$doc = new doc();
$doc->title->textContent = 'タイトル'; 
--></code>

<h2>要素を1つ作成する</h2>
<p>要素を1つ作成するには、次のように行います。<br>
<var>$doc(&lt;タグ名&gt;, 本文, [属性名=&gt;属性値])</var>。戻り値は作成された要素です</p>
<code class="php" data-title="要素を1つ作成する"><!--
// <div class="example">本文</div> を作成する

$doc = new doc();
$div = $doc('<div>', '本文', ['class'=>'example']);
$doc->body->appendChild($div); 

--></code>
<ul>
<li>本文は省略可。本文に含まれるタグはエスケープされます</li>
<li>属性は省略可。エスケープされます</li>

</ul>

<h2>外部ファイルのインポート</h2>


<p>外部ファイルを読み込むには、もう一つdocオブジェクトを作成して、そこからインポートします。<br>
<var>$doc(別docの要素 or 別doc)</var>でインポートできます。戻り値はインポートされた要素です</p>


<code class="php" data-title="外部ファイルを読み込む1"><!--
$doc = new doc();
//外部ファイル化したフッタを読み込む
$exdoc = new doc('<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title></title></head><body><footer id="footer"></footer></body></html>');

$footer = $doc($exdoc->footer); //要素を1つインポート
$doc->body->appendChild($footer);


--></code>
<p>上記は、次のように省略して書くこともできます。</p>
<code class="php" data-title="外部ファイルを読み込む2"><!--
$doc = new doc();
//外部ファイル化したフッタを読み込む
$exdoc = new doc('<footer id="footer"></footer>');

$footer = $doc($exdoc); //全体をインポート
$doc->body->appendChild($footer);


--></code>


<h2>部品ファイル</h2>

<p>外部ファイルを読み込む別の方法として、部品ファイルがあります。</p>


<h3>部品ファイルの作成</h3>

<p>部品ファイルの名前は必ず<var>doc-</var>から始めます。PHPファイルです</p>

<code class="php" data-title="doc-ul.php"><!--
<?php
$doc = new doc('<ul></ul>'); // 部品なので<!DOCTYPE>は書かない

// $docを操作してHTMLを作り上げる

return $doc; // 最後に$docオブジェクトを返す
--></code>


<h3>ディレクトリの設定</h3>
<p>部品ファイルを置くディレクトリを<var>doc::$dir</var>に設定してください。</p>

<h3>部品タグの利用</h3>
<p>以上の準備が揃うと、部品タグが使用できるようになります。<var>&lt;doc-ul&gt;&lt;/doc-ul&gt;</var><br>
部品タグは部品ファイルの内容に自動的に置換されます。</p>

<h3>ヒント</h3>

<ul>
<li>部品ファイルはローカルスコープで実行されます</li>
<li>部品タグは必ず閉じましょう</li>
<li>部品タグは<var>$doc(&apos;&lt;doc-ul&gt;&apos;)</var>のように新規作成できます</li>
<li>部品ファイルでは<var>$el</var>で元のタグにアクセスできます</li>
<li>部品ファイルにデータを渡すには、属性経由をオススメします。<br>
<var>&lt;doc-ul data=&quot;example&quot;&gt;&lt;/doc-ul&gt;</var>なら<var>$el-&gt;getAttribute(&apos;data&apos;);</var>で取得します</li>
<li>循環読み込みには気を付けてください。無限ループします</li>
</ul>



<h2>実例サンプル</h2>

<code class="php" data-title="リストを作ってみよう"><!--
//テンプレート側で空のulを用意しておこう。もちろんID付きで
$doc = new doc('<ul id="list"></ul>');

foreach([1,2,3] as $v) {
    //li要素を作成しよう    
    $li = $doc('<li>', $v);
    //ulに追加しよう
    $doc->list->appendChild($li);
}

print $doc; //完成


--></code>

<code class="php" data-title="テーブルを作ってみよう"><!--
//電話機のボタン配列。これをtableタグにする
$button = [[1,2,3], [4,5,6], [7,8,9], ['*',0,'#']];

//テンプレート側で空のtableを用意しておく
$doc = new doc('<table id="phone-button"></table>');

foreach($button as $row) {
    $tr = $doc->phone_button->appendChild($doc('<tr>')); //行毎にtr要素を作ってtableに追加
    foreach($row as $v){
        $tr->appendChild($doc('<td>', $v));  //セル毎にtd要素を作ってtrに追加
    }
}

print $doc; //完成


--></code>


<h2>[付録] DOM操作の早見表</h2>

<p>DOMを知らない人でも、次の8つの操作を覚えておけば大丈夫。</p>

<code class="php"><!--
//本文を設定する(タグはエスケープされる)
$el->textContent = '本文';

//属性を設定する
$el->setAttribute('属性名', '属性値');

//属性を削除する
$el->removeAttribute('属性名');

//要素を子の最後に追加する
$el->appendChild($new_el);

//要素をコピーする(戻り値がコピーされた要素)
$el->cloneNode(true);

//要素を置換する
$el->parentNode->replaceChild($new_el, $el);

//要素を削除する
$el->parentNode->removeChild($el);

//中身を全て削除する
$el->textContent = '';


--></code>

<p>次の3つは覚えるのは難しいので、必要になった時に参考にしてください</p>

<code class="php"><!--
//要素を子の最初に追加する
$el->insertBefore($new_el, $el->firstChild);

//要素を前に追加する
$el->parentNode->insertBefore($new_el, $el);

//要素を後ろに追加する
$el->parentNode->insertBefore($new_el, $el->nextSibling);
--></code>

</div>
</article>


<script>
table_of_contents()
</script>

</body>
</html>