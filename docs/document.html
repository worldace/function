<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>documentクラス</title>
<link href="style.css" rel="stylesheet">
<script src="script.js"></script>
</head>

<body>

<article>
<header>
<h1>documentクラス</h1>
<nav><a href="./"><img src="back.svg" width="24" height="24" title="ホームに戻る"></a></nav>
</header>

<div id="contents">

<p>PHPのDOMを使いやすくするクラス。HTMLの出力やスクレイピング用に</p>

<h2>new</h2>
<p>documentオブジェクトを作成する</p>
<table class="function">
<tr><th>引数</th><th>説明</th></tr>
<tr class="option"><td>1</td><td>
HTML文字列、XML文字列<br>
省略時は内蔵テンプレートが使用されます。下記サンプルと同じHTMLです
</td></tr>
<tr class="return"><td>戻</td><td>
documentオブジェクト
</td></tr>
</table>

<code class="php" data-title="サンプル"><!--
$document = new document('<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title></title></head><body></body></html>');
--></code>
<p class="info-yellow">引数のHTMLは、全体を1つのタグで囲っておく必要があります</p>
<p class="info-yellow">ベースとなるHTMLには<var>&lt;!DOCTYPE&gt;</var>が必要です</p>

<h2>HTMLの出力</h2>

<p>documentオブジェクトは、文字列として評価されると自動的に文字列に変換されるので、出力するだけでHTMLを表示できます。</p>

<code class="php" data-title="HTMLの出力"><!--
$document = new document();

print $document; //HTMLが表示される

$html = "$document"; //文字列としてコピーされる
--></code>

<p>DOM要素も同様に、自動的に文字列に変換されます</p>

<code class="php" data-title="DOM要素の出力"><!--
print $document->body; // <body></body>
--></code>

<h2>id付タグの短縮構文</h2>


<p>id属性が付いているタグには<var>$document-&gt;id名</var>でアクセスできます。<br>
操作したいタグにはあらかじめid属性を付けておくと、綺麗なコードが書けます。</p>



<code class="php" data-title="id付タグの短縮構文"><!--
$document->exapmle  //$document->getElementById('example') の短縮形
--></code>
<p>戻り値はDOM要素です。存在しなければnull</p>


<h2>主要タグの短縮構文</h2>

<p><var>html</var><var>head</var><var>title</var><var>body</var>の4つタグには短縮構文があり<var>$document-&gt;タグ名</var>でアクセスできます。</p>

<code class="php" data-title="主要タグの短縮構文"><!--
$document->body  //$document->getElementsByTagName('body')[0] の短縮形

$document->title->textContent = 'タイトル名'; //titleはweb標準と異なるので注意
--></code>
<p>戻り値はDOM要素です。存在しなければnull</p>


<h2>属性アクセスの短縮構文</h2>

<p>属性へのアクセスは短縮構文があり<var>$el-&gt;属性名</var>と書けます。</p>
<code class="php" data-title="属性アクセスの短縮構文"><!--
$document->body->id  //$document->body->getAttribute('id') の短縮形

$document->body->id = 'value'  //$document->body->setAttribute('id', 'value') の短縮形

unset($document->body->id)  //$document->body->removeAttribute('id') の短縮形
--></code>


<h2>タグの検索</h2>

<h3>セレクタで検索</h3>
<p>documentオブジェクトには、お馴染みの<var>querySelector</var>があります。<br>
CSSセレクタを使用して、ドキュメント全体からタグを検索できます。</p>

<code class="php" data-title="タグの検索"><!--
//単数検索
$document->querySelector('CSSセレクタ'); //戻り値はDOM要素またはnull

//複数検索
$document->querySelectorAll('CSSセレクタ'); //戻り値は配列
--></code>

<p class="info-green">querySelector()の第二引数にDOM要素を渡すと、その要素を基点に検索できますが、
通常は<var>$el-&gt;querySelector()</var>を使用します。</p>

<h3>対応CSSセレクタ</h3>

<table>
<tr><th>要素</th><td>a</td></tr>
<tr><th>ID</th><td>#a</td></tr>
<tr><th>クラス</th><td>.a</td></tr>
<tr><th>属性名</th><td>[a]</td></tr>
<tr><th>属性名と値</th><td>[a="b"]</td></tr>
<tr><th>and</th><td>ab</td></tr>
<tr><th>子孫</th><td>a b</td></tr>
<tr><th>子</th><td>a > b</td></tr>
<tr><th>弟</th><td>a + b</td></tr>
<tr><th>弟全て</th><td>a ~ b</td></tr>
<tr><th>全て</th><td>*</td></tr>
</table>


<h3>querySelector()の短縮構文</h3>

<p><var>querySelector()</var>には短縮構文が用意されていて、jQuery風に書けるようになります。<var>$document('セレクタ')</var></p>

<code class="php" data-title="querySelector()の短縮構文"><!--
$document('.example') // $document->querySelector('.example') の短縮形

$document('*.example') // $document->querySelectorAll('.example') の短縮形
--></code>

<p>この短縮構文のデフォルトは<b>単数検索</b>です。<br>
セレクタの頭に<var>*</var>に付けると複数検索になります。</p>


<h2>タグの作成</h2>

<h3>タグを1つ作成する短縮構文</h3>
<p>タグの作成には短縮構文があり<var>$document(&lt;タグ名&gt;, 本文, [属性名=&gt;属性値])</var>で1つタグが作成できます。<br>
戻り値はDOM要素で、本文と属性は省略できます。</p>

<code class="php" data-title="タグを1つ作成する短縮構文"><!--
print $document('<div>', '本文', ['class'=>'example']); // <div class="example">本文</div>

// 次のコードの短縮形
// $div = $document->createElement('div');
// $div->textContent = '本文';
// $div->setAttribute('class', 'example');
--></code>

<h3>子タグも一括作成</h3>

<p><var>ul</var><var>ol</var><var>select</var><var>table</var>のタグは、本文を配列で渡すと、子タグも一括して作成できます。</p>

<code class="php" data-title="ul"><!--
$document('<ul>', [1,2], ['id'=>'example']);

//<ul id="example">
//  <li>1</li>
//  <li>2</li>
//</ul>
--></code>

<code class="php" data-title="select"><!--
$document('<select>', [1,2]);

//<select>
//  <option value="1">1</option>
//  <option value="2">2</option>
//</select>
--></code>


<code class="php" data-title="table"><!--
$document('<table>', [1,2]);

//<table>
//  <tr><td>1</td></tr>
//  <tr><td>2</td></tr>
//</table>

$document('<table>', [[1,2], [3,4]]);

//<table>
//  <tr><td>1</td><td>2</td></tr>
//  <tr><td>3</td><td>4</td></tr>
//</table>
--></code>
<h3>HTML文字列をDOM化</h3>

<p>HTML文字列を一括してDOM化するには<var>$document('HTML文字列')</var>で可能です。<br>
戻り値は<var>DocumentFragment</var>。これは<var>appendChild()</var>などに渡すと挿入できます。</p>

<code class="php" data-title="HTML文字列をDOM化"><!--
$fragment = $document('<footer><a href="http://example.com/">Home</a></footer>');

$document->body->appendChild($fragment); // <body>の最後に<footer>が挿入される
--></code>


<h2>[付録] DOM操作の早見表</h2>

<p>当クラスはDOMに慣れている人向けに作られていますが、DOMを知らない人でも次の早見表を使えば大丈夫。</p>

<code class="php"><!--
//タグを検索する
$document->querySelector('セレクタ');    //戻り値はDOM要素またはnull
$document->querySelectorAll('セレクタ'); //戻り値は配列

//タグを作成する
$el = $document->createElement('タグ名');//戻り値はDOM要素


//中身を取得する
$el->textContent; //戻り値はタグを含まない文字列

//中身を取得する
$el->innerHTML;   //戻り値はタグを含む文字列

//中身を変更する
$el->textContent = '文字列はエスケープされる';

//中身を変更する
$el->innerHTML   = '文字列はエスケープされない';

//中身を全て削除する
$el->textContent = '';


//自身を取得する
$el->outerHTML;  //戻り値はタグを含む文字列

//自身を変更する
$el->outerHTML = '文字列はエスケープされない'


//タグ名を取得する
$el->tagName; //戻り値は小文字

//属性を取得する
$el->getAttribute('属性名'); //戻り値は文字列

//属性を設定する
$el->setAttribute('属性名', '属性値');

//属性を削除する
$el->removeAttribute('属性名');


//タグを子の最後に追加する
$el->appendChild($new_el);

//タグを子の最初に追加する
$el->insertBefore($new_el, $el->firstChild);

//タグを前に追加する
$el->parentNode->insertBefore($new_el, $el);

//タグを後ろに追加する
$el->parentNode->insertBefore($new_el, $el->nextSibling);


//タグを置換する
$el->parentNode->replaceChild($new_el, $el);

//タグを削除する
$el->parentNode->removeChild($el);

//タグをコピーする
$el->cloneNode(true); //戻り値はDOM要素


//タグの子孫からタグを検索する
$el->querySelector('セレクタ');    //戻り値はDOM要素またはnull
$el->querySelectorAll('セレクタ'); //戻り値は配列
--></code>


<p class="info-blue">PHP8から最新のDOMが使えるようになり、タグの追加・置換・削除が簡単になります。<a href="https://wiki.php.net/rfc/dom_living_standard_api" target="_blank">参考</a></p>

</div>
</article>


<script>
table_of_contents()
</script>

</body>
</html>